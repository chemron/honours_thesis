\documentclass[11pt,a4paper,onecolumn]{report}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{lmodern}
\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}
\usepackage{bm}
\usepackage[margin=2cm]{geometry}
\usepackage{array}
\usepackage{physics}
\usepackage{amssymb}
\usepackage{textcomp}
\usepackage[T1]{fontenc}
\usepackage{gensymb}
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage{enumerate}
\pagestyle{fancy}
\setlength{\headheight}{13.6pt}

\usepackage{tikz}
\usetikzlibrary{shapes.geometric, arrows, calc}
\usepackage[nottoc, numbib]{tocbibind}
\tikzstyle{cool} = [rectangle, rounded corners, minimum width=3cm, minimum
height=1cm, text centered, draw=black, fill=gray!30, text width=3cm]
\tikzstyle{arrow} = [thick, ->, >=stealth] \tikzstyle{line} = [thick, -,
>=stealth]

\usepackage[detect-all]{siunitx}
\usepackage{breqn}
\usepackage{subfigure}
\usepackage{geometry}
\usepackage{listings}
\usepackage{caption}
\usepackage[utf8]{inputenc}
\usepackage{hyperref}
\usepackage{titlesec}
\usepackage[square,numbers,comma,sort&compress]{natbib}
\usepackage{upgreek}
\usepackage{aas_macros}
\usepackage{doi}
\usepackage{siunitx}
\usepackage{textgreek}


\geometry{a4paper, left=25mm, top=25mm,} % total={160mm,247mm} <- overspecification
\graphicspath{{figures/} }
\renewcommand{\listfigurename}{Figures}


\captionsetup{justification   = raggedright, singlelinecheck = false}

\hypersetup{colorlinks, citecolor=black, filecolor=black, linkcolor=black,
    urlcolor=black}

\renewcommand{\bibname}{References}

\bibpunct{(}{)}{;}{a}{}{,}

\hypersetup{colorlinks, citecolor=black, filecolor=black, linkcolor=black,
    urlcolor=black}


\newcommand*\chem[1]{\ensuremath{\mathrm{#1}}}

\newcommand{\threevdots}{%
  \vbox{\baselineskip1ex\lineskiplimit0pt%
  \hbox{.}\hbox{.}\hbox{.}}}



% diagnose: Label(s) may have changed. Rerun to get cross-references right.
% \def\@testdef #1#2#3{% \def\reserved@a{#3}\expandafter \ifx \csname
% #1@#2\endcsname \reserved@a  \else \typeout{^^Jlabel #2 changed:^^J%
% \meaning\reserved@a^^J% \expandafter\meaning\csname #1@#2\endcsname^^J}%
% \@tempswatrue \fi}


%opening
\title{Thesis}
\author{Cameron Smith\\
Student ID: 28792912\\
Supervisors: Andrew Casey, Alina Donea}
\date{\today}



\begin{document}


\begin{titlepage}
  \begin{center}
    \vspace*{2cm}
    \Huge
    \textbf{Title of your Thesis}

    \vspace{2cm}
    \LARGE
    \textbf{Cameron Smith}

    \vspace{0.8cm}
    \Large \textit{Supervisors:}\\
    Andrew Casey\\
    Alina Donea

    \vfill
    \large
    An honours thesis presented for the degree of\\
    Bachelor of Science Advanced - Research (Honours)

    \vspace{0.3cm}
    \includegraphics[width=0.2\linewidth]{"Monash_Logo"}\\
    School of Physics and Astronomy\\
    Faculty of Science\\
    Monash University\\
    Australia

    \vspace{0.5cm}

    \today

  \end{center}
\end{titlepage}

\chapter*{Abstract}



\chapter*{Acknowledgements}

\tableofcontents


\listoffigures







%
%
%
%
\chapter{Introduction}
%
%
%
%



%TODO: Introduction (maybe borrow slightly from lit review)


%
% Project outline from lit review
%

To train a cGAN to generate magnetograms from seismic maps, we require a
training set consisting of seismic maps and the corresponding magnetograms.
While the farside seismic maps are readily available\footnote{See
  \url{http://jsoc.stanford.edu/data/farside/}.}, corresponding magnetograms are
not. However, not all hope is lost. The STEREO-A spacecraft is in a heliocentric
orbit that traverses the Sun relative to the Earth, allowing it to observe the
farside during some points of the orbit. While STEREO-A does not capture
magnetograms of the Sun, it does take EUV images which can be used to create
magnetograms by using a cGAN \citep{Kim2019}.\\

A small complication is that no data is available from when STEREO-A was
directly opposite the Earth (between March and July 2015), due to the
interference from the Sun. This limits the ability to get magnetograms that
exactly coincide with the farside seismic maps. To compensate for this, we can
match farside seismic maps with images taken by STEREO-A at an earlier (later)
time when it is behind (ahead of) the farside, such that the same `face' of the
Sun is imaged due to it's rotation. After generating the magnetograms from the
STEREO-A EUV images, we can create a dataset of seismic maps with the
corresponding magnetogram (albeit with some time difference). This process is
summarised in Figure \ref{fig:Project_summary}.\\



\begin{figure}
  \centering
  \begin{tikzpicture}[node distance=5.5cm]
    % \draw[help lines] (0,-5) grid (10,10);
    \node (D) [cool, above=1.5cm] {SDO Dopplergram}; \node (P) [cool, right
      of=D] {Farside \quad \quad \quad \qquad  seismic map}; \node (E) [cool]
    {STEREO EUV image}; \node (M) [cool, right of=E, below=0.5cm] {STEREO
      Magnetogram}; \node (F) [cool, right of=M, above=1cm] {Farside\\
      Magnetogram}; \node (S) [cool, below=1.5cm] {SDO Magnetogram};

    \coordinate (FF) at ([xshift=-1.5cm]F.west); % we collect the edges in
    front of Q
    \coordinate (MM) at ([xshift=-1.5cm]M.west); % we collect the edges in
    front of Q

    \draw [arrow] (D) -- node[anchor=south, text width=2cm] {Helioseismic
      Holography} (P); \draw [arrow] (MM) -- node[anchor=south] {cGAN} (M);
    \draw [line] (P) -|  (FF); \draw [line] (M) -|  (FF); \draw [line] (S) -|
    (MM); \draw [line] (E) -|  (MM); \draw [arrow] (FF) -- node[anchor=south]
    {cGAN} (F);

  \end{tikzpicture}
  \caption[Project Pipeline]{Summary of the project. A cGAN is trained on SDO
    data to be able to generate EUV images. This is applied to STEREO EUV images
    to generate STEREO magnetograms. These are used in conjunction with farside
    seismic maps to train a new cGAN to generate magnetograms from seismic maps,
    allowing constant surveillance of the farside magnetic field.}
  \label{fig:Project_summary}
\end{figure}


% get some




%
%
%
%
%
%
\chapter{Background}
%
%
%
%
%
%



%
%
\section{The Sun}
%
%


%
\subsection{Helioseismology}
%
\label{sec:HSM}


%
% TODO: is this still a relevant title?
\subsection{The Solar Magnetic field}
%
\label{sec:solar magnetic field}


%
%
\section{Space Weather}
%
%



%
%
\section{Farside Helioseismic Holography}
%
%




%
%
\section{Deep Learning}
%
%

%
\subsection{Structure}
%

\subsubsection*{Input}

\subsubsection*{Fully Connected Layer}

\subsubsection*{Convolutional Layer}



%
\subsection{Learning}
%

\subsubsection*{Backpropagation}


%
\subsection{Generative Adversarial Networks}
%


%
\subsection{Conditional Generative Adversarial Networks}
%


% Lit review stuff



%
%
%
%
\chapter{Data Preparation}
%
%
%
%




\begin{itemize}

  \item We need to construct two datasets:
  
  \begin{itemize}
    \item Nearside: Directly compare EUV 304 to magnetograms
    \item Farside Directly compare farside helioseismic maps with farside magnetograms
  \end{itemize}
  
  \item Furthermore, to go from 1 -> 2,  we need a set of farside EUV 304 which
  matches the nearside EUV 304 dataset,

  \item To maximise effectiveness of the networks, we need to make the images in
  each dataset indistinguishable in every aspect except for the subject of
  interest (i.e. the solar activity for the given image)

  
  \item Therefore, we need to account for the following factors
  
  \begin{enumerate}[i]
    \item Changes in time of image capture
    \item Changes in location of image capture
    \item The solar cycle in which the image was taken
    \item Position of the sun in images
    \item Orientation of the Sun in images
    \item Projection used in image
    \item Amplitude of pixel values between image data-sets
    \item Instrument degradation over time
    \item Instrument clipping
    \item Corrupted images or images with data artifacts
  \end{enumerate}



  \item Nearside vs Farside (i.e. why we need it)
  \item Data sources were:
        \begin{itemize}
          \item STEREO EUV images
          \item AIA EUV images
          \item AIA magnetograms
          \item farside helioseismic holography maps
        \end{itemize}
  \item figure showing positions and trajectory of stereo, sun earth, SDO and
        imaginary satellite for acoustic maps
  \item figure (maybe the same one) showing plot of stereo position in
  \item position data from http://www.srl.caltech.edu/STEREO/docs/position.html
  \item This is in Heliocentric Earth equatorial (HEEQ): This system has its Z
        axis parallel to the Sun's rotation axis (positive to the North) and its X
        axis towards the intersection of the solar equator and the solar central
        meridian as seen from the Earth. This system is sometimes known as
        heliocentric solar (HS)

\end{itemize}

-

\section{Data Collection}
% Changes in time of image capture
% Changes in location of image capture
% The solar cycle in which the image was taken


\subsection{Nearside Data}
\begin{itemize}
  \item as shown in in figure \ref{fig:Project_summary}, we need to generate solar
        magnetograms from EUV \SI[]{304}[]{\angstrom} images
  \item SDO captures these EUV images with a cadence of 12 seconds, and
        magnetograms every 45 seconds.
  \item This huge image database allows us compare pairs of these images with
        very little time difference, making SDO the ideal candidate for this data.
  \item To train GAN1, images were collected every 12 hours, same as
        \cite{Kim2019} - allowing us to get many images which are distinct enough for
        training
  \item these images were taken over solar cycle 24 between 2010, when the first
        SDO data became available, and december 2019 (the end of the solar cycle).
  \item as the global magnetic field flips every solar cycle (see Section
        \ref{sec:solar magnetic field}), this gave consistent magnetograms across the
        data set.
  \item due to a combination of missing images, and images excluded due to poor
        quality (see Section \ref{sec:Data prep}) resulted in a total of 4247
        EUV/magnetogram pairs.

\end{itemize}


\subsection{Farside Data}
\begin{itemize}
  \item need to compare EUV with seismic maps
  \item Why STEREO makes sense for this
  \item while the seismic maps are always generated for the solar farside, the
        EUV images captured by STEREO will only image the farside for some of
        it's orbit, as can be seen in Figure \ref{fig:stereo_pos}. This is
        further complicated by reduced telemetry rates with STEREO between August 2014 and
        January 2016, with complete instrument shut off between March and July
        2015, due to STEREO's superior solar conjunction. Details of this phase
        of the STEREO mission can be found in \citet{ossing_stereo_2017}.
        % https://stereo-ssc.nascom.nasa.gov/solar_conjunction.shtml
  \item Appendix \ref{app:fun orbit} shows the trajectory of STEREO A as it is
        leaving earth.
  \item As such, any STEREO image used would not be directly imaging the farside
  \item due to the rotation of the sun, the `face' of the Sun imaged by STEREO
  would also be imaged through farside helioseismic holography at a different
  time. For example, if STEREO imaged the Sun while \SI[]{45}[]{\degree} from
  the solar farside, after approximately 3 days, the Sun would have rotated
  such that the same `face' of the Sun would now be on the farside, and could be
  imaged by farside helioseismic holography.
  \item By using this rotation to our advantage, we can effectively compare
  farside seismic maps with not-quite-farside STEREO EUV images, albeit with
  some time delay between images.
  \item This method isn't perfect however, and has two primary drawbacks:
  \begin{enumerate}
    \item The differential rotation of the Sun means that active regions won't
    necessarily be in the same position after a time delay
    \item Active regions are constantly changing, for example new active regions may emerge on the surface over the course hours or days,
    while the decay of sunspots may last from days to weeks
    \citep{van_driel-gesztelyi_evolution_2015}.
  \end{enumerate}
  \item This will be discussed further in section \ref{chap:discussion}.

  \item To use this method, we must first determine the rotational period of the
  Sun
  \item This is not as obvious as it may at first seem, due to the Sun's
  differential rotation
  \item an appropriate choice for this period is given by the Carrington rotation.
  \item it is the average synodic rotational period of sunspots, which roughly
  corresponds to the synodic rotation of the Sun at a latitude of \(\SI[]{26}[]{\degree}\) \citep{carrington_observations_1863}
  \item this Carrington period is \(27.2753\) days which means it takes on average of \(27.2753\) days for a sunspot to rotate around the
  sun, relative to earth.

  \item In the heliocentric Earth Equatorial coordinate system, where the Z axis
 as the axis of solar rotation, and the x axis points from the centre of the sun the earth the angle between spacecraft and solar farside is given by:
\end{itemize}

\begin{align}
  \theta = \arctan{\frac{y}{x}}
\end{align}

- this gives:
\begin{align}
  t_{stereo} = t_{farside} + \frac{\theta}{2\pi}T
  \intertext{or equivalently:}
  t_{farside} = t_{stereo} - \frac{\theta}{2\pi}T
\end{align}
- using this, for each point in stereo time, i calculated the equivalent farside
time \\
- from this I download the FITS STEREO images that corresponded to the farside
images \\
- (farside are created every 12 hours between 2010 and now)

\begin{figure}[ht]
  \centering
  \includegraphics[width = 0.7\linewidth]{STEREO_pos.pdf}
  \caption[STEREO A Trajectory]{Trajectory of STEREO A between October 2006 and January 2001 in the
  Heliocentric Earth Equatorial coordinate system. In these coordinates, the Sun
  is at the origin with the Earth fixed on X axis. Each `bump' in STEREO's
  Trajectory correspond to a year on Earth. \textit{Image generated using
  data provided by Space Radiation Lab at California Institute of Technology.}}
  \label{fig:stereo_pos}
\end{figure}


\section{Image Projections}
% Position of the sun in images
% Orientation of the Sun in images
% Projection used in image

\begin{itemize}
  \item need to take into account the position of the Sun, the orientation of
  the Sun, and how the image was captured (i.e. what projection used - CCD with
  heloprojective cartiesian)
  \item To train the GAN, features of the Sun need to be in the same position in both
  the input and output training images.
  \item As there are many ways to project data from a three dimensional object
  (e.g. the Sun) on to a two dimensional image, this overlap is not guaranteed
  in general, even if two images are taken at the same place and time.
  \item therefore, to compare two different images of the Sun, the projection used
must be taken into account
\end{itemize}

\subsection{Nearside Data}
\begin{itemize}
  \item Fortunately both EUV and magnetogram images are taken by SDO at very similar
  times, and both sets of images are projected into helioprojective-cartesian
  coordinates.
  \item In this coordinate system, observations are projected against the
  celestial sphere, and positions are measured in the longitude \(\theta_x\) or
  latitude \(\theta_y\) of the celestial sphere, with the centre of the disk
  (i.e. the point of the Sun closest to the observer) at the origin.
  \item Note: this is not exactly correct, as the camera sensor (in this case a
  CCD detector) is a flat plane. As such, we are actually projecting on to a
  tangent plane of the celestial sphere (gnomonic projection). However since the
  angle subtended by the solar disk is \(\approx \SI[]{0.3}[]{\degree} \), this
  can be accurately approximated as a helioprojective projection. In fact, at a
  distance of 1 AU (approximately the orbital radius of SDO and STEREO), the
  angles on the tangent plane are the same as the angles on the celestial sphere
  to at least five significant figures \cite{thompson_w_t_coordinate_2006}
  %TODO: is this actually approximated like this?
  \item The helioprojective latitude and longitude of each pixel on the EUV and
  magnetogram images could be found using the metadata from each image.
  \item The instruments used to create these images are rotated relative to each
  other.
  \item to align the images, the images were rotated such that each column of
  vertical pixels had the same helioprojective longitude, and each row of pixels
  had the same helioprojective latitude.
  \item rotated such that the top of the image correspond to the northernmost part
  of the solar disk.
  \item however at different points of the orbit, the satellite is at a different
  distance from the sun, and so the relative size of the sun in each image will
  change throughout the one-year orbit.
  \item to remove this discrepancy, while also removing unnecessary pixels, the
  images were cropped to the radius of the sun, again using information
  extracted from the image metadata.
\end{itemize}

\subsection{Farside Data}
\begin{itemize}
  \item As the Stereo EUV data also used the same helioprojective-cartesian
  projection used for the nearside data, this data was prepared (?) in the same
  manner, first rotating the images before cropping them to the radius of the
  Sun.
  \item rotated such that the top of the image correspond to the northernmost part
  of the solar disk.
  \item this process was not so simple in the case of the farside helioseismic
  holography seismic maps.
  \item these images were instead projected into Carrington heliographic
  coordinates, where the positions are measured in latitude (\(\Theta\)) and
  Carrington longitude (\(\Phi_c\)).
  \item This coordinate system rotates with the Sun such that the prime meridian
  coincides with the central meridian (according to an observer on Earth)
  approximately every 27 days, depending on the position of Earth in it's orbit.
  \item As such, to directly compare the seismic maps with the STEREO EUV
  data, we must first project the seismic maps into helioprojective-cartesian
  coordinates.

  \item For each pixel in the final (helioprojective-cartesian) image, we need
  to find the corresponding point on the original (heliographic) image.
  \item In general this point will not match up exactly to the centre of a pixel
  on the original image and so an interpolation method needs to be used to find
  determine the value of the original pixel.
  \item to find this point we must first find the mapping from
  helioprojective-cartesian coordinates to Carrington heliographic coordinates.
  \item To do this, we use and intermediate transformation to
  heliocentric-cartesian coordinates. i.e.:
\end{itemize}

\begin{align*}
  \text{Helioprojective-cartesian} \rightarrow \text{Heliocentric-cartesian} \rightarrow \text{Carrington Heliographic}
\end{align*}

Heliocentric-cartesian coordinates give the true spatial position of an object
(x, y, z), with the centre of the Sun at the origin. The z-axis
points toward the observer, while the y-axis is in the plane containing the
z-axis and the rotational axis of the Sun. The x-axis is oriented such that the three axes
are orthogonal and create a right-hand coordinate system. \\

To convert helioprojective-cartesian coordinates into heliocentric-cartesian
coordinates, we use the following transformation, provided by
\citet{thompson_w_t_coordinate_2006}:
\begin{align}
  x &= d \cos \theta_y \sin \theta_x \, , \\
  y &= d \sin \theta_y \, and \\
  z &= D_\odot - \cos \theta_y \cos \theta_x \, .
  \label{eqn:heliop_to_helioc}
\end{align}
Where \(d\) is the distance is the distance between the observer and the point
being observed, and \(D_\odot\) is the distance between the observer and the centre of
the Sun. After some trigonometry, it can be shown that if the point being
observed is on the surface of the Sun, then
\begin{align}
  d &= D_0 \cos\theta - \sqrt{D_\odot^2 \left( \cos^2\theta - 1 \right) + R_\odot } \, , \\
  \intertext{where}
  \theta &= \cos^{-1}\left(\cos\theta_y \cos\theta_x \right) \, .
\end{align}

Similarly, we can convert from heliocentric-cartesian coordinates to carrignton heliographic
coordinates as follows:
\begin{align}
  \Theta &= \sin^{-1}\left( \frac{y \cos B_0 + z \sin B_0}{r}\right) \, , \\
  \Phi_c &= \arg (z \cos B_0 - y \sin B_0, x) + \Phi_{0} \,
  \intertext{where}
  r &= \sqrt{x^2 + y^2 + z^2} \, ,
\end{align}
and \(B_0\) and \(\Phi_{0}\) are the Carrington heliographic latitude and
longitude of the Observer. \\

\begin{itemize}
  \item This completes the required transformation, as the constants \(B_0\),
  \(\Phi_0\) and \(D_\odot\) can be obtained from the image metadata of each seismic
  map and corresponding STEREO EUV image we are comparing it too.
  \item Using this transformation, with bi-linear interpolation, we were able
  transform the STEREO Carrington heliographic images into
  Helioprojective-cartesian images that matched the STEREO IMAGES
  %TODO: reiterate that we want to match the seismic images with the stereo
  %images
  %TODO: compare stereo with transformed seismic maps
\end{itemize}


\section{Data pre-processing}
% Amplitude of pixel values between image data-sets
% Instrument degradation over time
% Instrument clipping
% Corrupted images or images with data artifacts

\label{sec:Data prep}


\begin{itemize}
  \item ok, so now that we have all the images fully aligned we now need to look
  at the images themselves
  \item Both the STEREO EUVI and SDO AIA use a Charge-coupled device (CCD) to
  image the Sun at a wavelength of
  \(\SI[]{304}[]{\angstrom}\) \citep{kaiser_stereo_2008,lemen_atmospheric_2012}.
  Each pixel in the CCD converts the incoming photons into electric charge,
  which is subsequently measured. This raw data is then processed to remove data
  artifacts caused by the imaging process, and the resulting image can then be
  used for analysis.  
  \item The value of each pixel (measured in digital number, or DN) on these images is then proportional to the
  solar spectral radiance over the width of the pixel.
\end{itemize}

\subsection{Ultraviolet Data}
\begin{itemize}
  \item From the 4313 AIA images used between 2010 and 2020, the pixel values
  for the AIA data range from \(\SI[]{-166}[]{DN}\) to \(\SI[]{16383}[]{DN}\).
  The get a handle on this data, a range of the pixel value percentiles were
  calculated for each image. This was plotted against time and can be seen in
  Figure \ref{fig:aia_percentiles}. Corrupted or otherwise poor quality images
  could then be identified due to the large irregularity in the percentiles of
  those images, as can be clearly seen in Figure \ref{fig:aia_outliers}. After
  reviewing the offending images, a simple threshold was used to remove the
  outliers.
  \item Had to consider the following effects:
  \begin{enumerate}
    \item corrupted images
    \item instrument degradation
    \item 
  \end{enumerate}
\end{itemize}


% outlier cutoff for stereo

% long term degredation aia

% long term degredation stereo


% instrument clipping

% shifting to match aia and stereo

% normalisation

\begin{figure}[t]%
  \centering
  \subfigure[]{%
    \label{fig:aia_percentiles}
    \includegraphics[width=\linewidth]{AIA_percentiles.png}%
  }%
  \qquad
  \subfigure[]{%
    \label{fig:aia_outliers}%
    \includegraphics[height=2in]{AIA_outliers.png}% 
  }%

  \caption[]{\subref{fig:aia_percentiles} The percentiles of AIA data for images
  taken every 12 hours between May 2010 and December 2020. Due to the large
  range of data, the 25th to 100th percentiles where plotted on a log scale.
  \subref{fig:aia_outliers} The 75th percentile of the AIA data. A simple
  threshold was used to remove poor quality data.}
  \label{fig:aia_data_prep}
\end{figure}






- However the 304\AA \ channel of SDO AIA is degrading over time
\citep{boerner_photometric_2014}, effectively reducing the exposure of the
image. Figures \ref{fig:aia_degradation} show a comparison in the exposures of
images taken in 2011, 2015 and 2019 respectively. To account for this
degradation, the image was clipped to the 95th percentile of the pixel
intensity and normalised.


\begin{figure}[t]%
  \centering
  \subfigure[]{%
    \label{fig:aia_2011}%
    \includegraphics[height=1.5in]{AIA_2011.01.01_00:00:00.png}% 
  }%
  \qquad
  \subfigure[]{%
    \includegraphics[height=1.5in]{AIA_2015.01.01_00:00:00.png}%
    \label{fig:aia_2015}%
  }%
  \qquad
  \subfigure[]{%
    \includegraphics[height=1.5in]{AIA_2019.01.01_00:00:00.png}%
    \label{fig:aia_2019}%
  }%
  \caption[]{Images taken by SDO AIA 304\AA \ on the first of January in 2011
    \subref{fig:aia_2011}, 2012 \subref{fig:aia_2015} and 2019
    \subref{fig:aia_2019}. Due to the degradation of the instrument, the
    exposure reduces over time. \textit{Images courtesy of NASA.}}
  \label{fig:aia_degradation}
\end{figure}



















%
%
%
%
%
%
%
%
\chapter{Training}
%
%
%
%
%
%
%
%













%
%
%
%
%
%
%
%
\chapter{Results}
%
%
%
%
%
%
%
%







%
%
%
%
%
%
%
\section{Analysis}
%
%
%
%
%
%


\begin{itemize}
  \item How do we analyse the data?
  \item absolute difference of images is a bad idea because:
  \begin{itemize}
    \item difficult to interpret error
    \item the surface area of the sun corresponding to a given pixel changes
    with radius (i.e. pixels at the solar limb will correspond to a larger
    section of the Sun than pixels in the centre of the image).
    \item This means that the magnetic field will be unevenly weighted towards
    the central pixels
  \end{itemize}
  \item An alternative to this is to calculate the total magnetic flux of a
  given image, and compare this to the total magnetic flux of the Sun half a
  rotation later
  \item this can be done with the following steps
  \begin{enumerate}
    \item for each pixel, find the helioprojective coordinates
  \end{enumerate}
\end{itemize}

\begin{align}
  \theta_x &= \Delta x (x - c_x) \, \text{, and} \\
  \theta_y &= \Delta y (y - c_y)
\end{align}

where  \((\Delta x, \Delta y)\) are the dimensions of one pixel in arcseconds,
\( (x, y) \) is the image coordinates of the pixel, and \( (c_x, c_y) \) is the
image coordinates of the centre of the disk. The dimensions and coordinates of
the centre of the disk could be obtained from the image metadata. The
helioprojective coordinates of each corner of each pixel can then be found by
adding/subtracting \(\frac{1}{2} (\Delta x, \Delta y)\). Using Equation
\ref{eqn:heliop_to_helioc}, we can convert these helioprojective coordinates
into heliocentric coordinates, i.e. the true spatial positions \((x, y, z)\) of
the four points \((\bm{a}, \bm{b}, \bm{c}, \bm{d})\) on the surface of the Sun.
To approximate the area subtended by the given pixel, we split these four points
into two triangles defined by the vectors \((\bm{c}-\bm{a}, \bm{b} - \bm{a}) \)
and \((\bm{c}-\bm{a}, \bm{d} - \bm{a}) \). The areas of these triangles can be
found 
\begin{align}
  A = \frac{1}{2} \abs*{\bm{v}_1 \times \bm{v}_2} \, ,
\end{align}


where \(\bm{v}_1\), \(\bm{v}_2\) are the vectors defining the triangle. By
summing over the areas of both triangles, we obtain an estimate of the surface
area corresponding to each pixel. Multiplying it by the magnitude of the
magnetic field measured at the pixel, we obtain the magnitude of the magnetic
flux of the pixel. Summing over all pixels gives us the total unsigned magnetic
flux, \(\bm{\phi}\), for that image. Figure \ref{fig:tumf_calc} shows an example
of the unsigned magnetic field, area and unsigned magnetic flux.


\begin{figure}[t]%
  \centering
  \subfigure[]{%
    \label{fig:tumf_calc_1}%
    \includegraphics[height=2.5in]{tumf_calc_1.png}% 
  }%
  \qquad
  \subfigure[]{%
    \label{fig:tumf_calc_2}%
    \includegraphics[height=2.5in]{tumf_calc_2.png}% 
  }%
  \qquad
  \subfigure[]{%
    \label{fig:tumf_calc_3}%
    \includegraphics[height=2.5in]{tumf_calc_3.png}% 
  }%
  \caption[]{The unsigned magnetic field \subref{fig:tumf_calc_1}, area
  \subref{fig:tumf_calc_2} and unsigned
  magnetic flux \subref{fig:tumf_calc_3} calculated using a HMI magnetogram,
  taken on 5th May, 2010.}
  \label{fig:tumf_calc}
\end{figure}



%
%
%
%
%
\chapter{Discussion and Conclusion}
\label{chap:discussion}
%
%
%
%
%









% Copied from earlier:
% \item By using this rotation to our advantage, we can effectively compare
%   farside seismic maps with not-quite-farside STEREO EUV images, albeit with
%   some time delay between images.
%   \item This method isn't perfect however, and has two primary drawbacks:
%   \begin{enumerate}
%     \item The differential rotation of the Sun means that active regions won't
%     necessarily be in the same position after a time delay
%     \item Active regions are constantly changing, for example new active regions may emerge on the surface over the course hours or days,
%     while the decay of sunspots may last from days to weeks
%     \citep{van_driel-gesztelyi_evolution_2015}.
%   \end{enumerate}
%   This will be discussed further in section \ref{chap:discussion}.



\bibliographystyle{mnras.bst}

\bibliography{Bibliography}


\appendix

\chapter{Coordinate Systems}
For a description of solar coordinate systems, see
\citet{thompson_w_t_coordinate_2006}.

\chapter{STEREO orbit}
\label{app:fun orbit}
\begin{figure}[ht]
  \centering
  \includegraphics[width=0.8\linewidth]{fun_orbit.png}
  \caption{Trajectory of STEREO spacecraft as it leaves the Earth and uses a gravity assist from the moon to reach it's orbit}
  \label{fig:fun_orbit}
\end{figure}

\chapter{just getting things down quickly}



\section{STEREO Magnetogram GAN}
- for the gan the input magnetograms and the seismic maps images needed to have
the same dimensions - while the seismic maps were 180 by 180 pixels, the
magnetograms were 1024 by 1024 pixels.

% currently thinking of upsampling seismic maps then downsampling magnetograms,
% but commented out paragraph shows my initial idea

% - to make them the same dimension, the magnetograms were resampled using
%   bicubic interpolation to the size of the seismic maps. This interpolation
%   method was chosen as it results in a smoother resampling with fewer
%   interpolation artifacts \citep{keys_cubic_1981}.


- to make them the same dimension, the seismic maps were resampled using bicubic
interpolation to the size of the magnetograms. This interpolation method was
chosen as it results in a smoother resampling with fewer interpolation artifacts
\citep{keys_cubic_1981}.



\end{document}

